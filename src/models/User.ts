/**
 * @module User
 * 
 * @file User.ts is a model file which contains the interface of schema and model for user collection.
 * @description It is used to define the schema and model for user.
 * email field will be use for indetify the user.
 */

import * as oMongoose from 'mongoose';
import reservedKeywords from '../utils/reservedKeywords';

/**
 * Define interface for user model
 */
interface IUser extends oMongoose.Document {
    username: string;
    pssword: string;
    status: string;
    email: string;
    createdDate: Date;
    updatedDate: Date;
    uploadedPhotos: oMongoose.Schema.Types.ObjectId[];
}

/**
 * Define user schema and set middleware function.
 */
const Schema = oMongoose.Schema;

const UserSchema = new Schema({
    /**
     * id field automatically generated by mongoDB
     */

    /**
     * email use as id for user
     */
    email: {
        type: String,
        required: true,
        unique: true,
    },
    name: {
        type: String,
        minlength: 4,
        maxlength: 64,
        required: true,
        unique: false,
    },
    pssword: {
        type: String,
        minlength: 4,
        maxlength: 128,
        required: true,
    },
    status: {
        type: String,
        enum: reservedKeywords.userStatusEnum,
        required: true,
    },
    createdDate: {
        type: Date,
        default: Date.now,
        required: true
    },
    updatedDate: {
        type: Date,
        default: Date.now,
        required: true,
    },
    uploadedPhotos: [
        /**
         * Using ref field, we can reference to other model like photos in NoSQL database.
         */
        {   
            type: Schema.Types.ObjectId,
            ref: 'photos'
        }
    ]
});

/**
 * Modle Middle ware function setting
 */
UserSchema.pre('save', function (next) {
    const currentDate = new Date();
    this.updatedDate = currentDate;

    if (!this.createdDate) {
        this.createdDate = currentDate;
    }
    next();
})

const User = oMongoose.model<IUser>('users', UserSchema);
export { User, IUser };